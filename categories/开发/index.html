<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lialosiu&#39;s Note</title>
    <meta property="og:type" content="website">
<meta property="og:title" content="Lialosiu&#39;s Note">
<meta property="og:url" content="http://lialosiu.com/categories/%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="Lialosiu&#39;s Note">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Lialosiu">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@lialosiu">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui-css@2.4.1/semantic.min.css"
          integrity="sha256-9mbkOfVho3ZPXfM7W8sV2SndrGDuh7wuyLjtsWeTI1Q=" crossorigin="anonymous">
    
<link rel="stylesheet" href="/css/app.css">

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-26091800-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-26091800-1');
    </script>
    
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
<div id="app">
    <div class="header-bar" :class="{'at-top': isWindowScrollTop}">
    <a class="site-name-block" href="/">
        <img class="site-master-avatar" src="https://www.gravatar.com/avatar/d3f817314d352b397f3a2c816ebc73bd?s=32" alt="avatar">
        <div class="site-title">Lialosiu&#39;s Note</div>
    </a>

    <div class="flex"></div>

    <div class="site-links">
        
            <a class="site-link" href="https://github.com/lialosiu" target="_blank">
                <i class="github icon"></i>
                <div class="text">Github</div>
            </a>
        

        
            <a class="site-link" href="https://steamcommunity.com/id/lialosiu" target="_blank">
                <i class="steam icon"></i>
                <div class="text">Steam</div>
            </a>
        

        
            <a class="site-link" href="https://twitter.com/lialosiu" target="_blank">
                <i class="twitter icon"></i>
                <div class="text">Twitter</div>
            </a>
        
    </div>
</div>

    <div class="site-header">
    <div class="header-img" data-parallax="scroll" data-image-src="/assests/header.jpg"></div>
    <div class="overlay">
        
            <h1 class="post-title">
                分类归档: 开发
            </h1>
        
    </div>
</div>

    <div class="site-body">
        <div class="left-side">
    <div class="left-side-twitter">
        <a class="twitter-timeline" data-lang="zh-cn" data-height="3000" data-theme="dark" target="_blank" rel="noopener" href="https://twitter.com/lialosiu?ref_src=twsrc%5Etfw">
    <div class="twitter-loading"></div>
</a>
    </div>
</div>
<div class="main-side">
    
        
            <article class="article article-type-post article-index ">
    <header class="article-header">
        
            
                <h1 class="title">
                    <a href="/2017/02/07/laravel-mongo%E5%AF%B9%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E5%90%8C%E5%80%BC%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/">laravel-mongo对不同类型同值的数据处理</a>
                </h1>
            
        
    </header>
    <div class="article-inner">
        <div class="article-meta">
            <div class="article-date">
                <i class="icon calendar" title="发布时间"></i>
                <time datetime="2017-02-07T03:51:38.000Z">2017-02-07
                    <small>11:51</small>
                </time>
            </div>
            
                <div class="article-category">
                    <i class="icon book" title="文章分类"></i>
                    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
                </div>
            
            
                <div class="article-tag">
                    <i class="icon tags" title="文章标签"></i>
                    <a class="article-tag-none-link" href="/tags/laravel/" rel="tag">laravel</a>, <a class="article-tag-none-link" href="/tags/mongo/" rel="tag">mongo</a>
                </div>
            
        </div>
        <div class="article-entry">
            
                <p>最近敲代码的时候发现，<a target="_blank" rel="noopener" href="https://github.com/jenssegers/laravel-mongodb">laravel-mongo</a> 在 ORM 的时候，如果用 save 更新一个值，类型不同但值相同，是不会写入 db 的…</p>
<p>举个栗子:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span> = <span class="keyword">new</span> <span class="title class_">Data</span>();</span><br><span class="line"><span class="variable">$data</span>-&gt;_id = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$data</span>-&gt;a = <span class="number">123</span>;</span><br><span class="line"><span class="variable">$data</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br></pre></td></tr></table></figure>

<p>那么mongo里面就是  <code>a: int32 = 123</code></p>
<p>这时候如果再</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span> = <span class="title class_">Data</span>::<span class="title function_ invoke__">find</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$data</span>-&gt;a = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br></pre></td></tr></table></figure>

<p>问题就来了…</p>
<p>mongo 里面的值还特么的是  <code>a: int32 = 123</code></p>
<p>并没有被更新成 <code>a: string = &#39;123&#39;</code></p>
<p>但是如果是个不同类型不同值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span> = <span class="title class_">Data</span>::<span class="title function_ invoke__">find</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$data</span>-&gt;a = <span class="string">&#x27;321&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br></pre></td></tr></table></figure>

<p>就会被更新成 <code>a: string = &#39;321&#39;</code></p>
<p>这个问题略蛋疼啊…</p>

            
        </div>
    </div>
    <footer class="article-footer">
    </footer>
</article>

        
            <article class="article article-type-post article-index ">
    <header class="article-header">
        
            
                <h1 class="title">
                    <a href="/2016/07/05/php-fpm%E9%85%8D%E7%BD%AE%E7%9A%84%E4%B8%80%E4%B8%AA%E5%9D%91/">php-fpm配置的一个坑</a>
                </h1>
            
        
    </header>
    <div class="article-inner">
        <div class="article-meta">
            <div class="article-date">
                <i class="icon calendar" title="发布时间"></i>
                <time datetime="2016-07-05T08:38:00.000Z">2016-07-05
                    <small>16:38</small>
                </time>
            </div>
            
                <div class="article-category">
                    <i class="icon book" title="文章分类"></i>
                    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
                </div>
            
            
        </div>
        <div class="article-entry">
            
                <p>调了一个下午，发现 php-fpm 有个怪坑</p>
<p>我在 docker 下，基于 <code>php:7.0-fpm</code> 镜像，构建了一个容器</p>
<p>并且 <code>ADD ./app.pool.conf /usr/local/etc/php-fpm.d/</code> ，放了个 pool 进去</p>
<p>具体内容为</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; Unix user/group of processes</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> The user is mandatory. If the group is not set, the default user&#x27;s group</span></span><br><span class="line"><span class="comment">;       will be used.</span></span><br><span class="line"><span class="attr">user</span> = www-data</span><br><span class="line"><span class="attr">group</span> = www-data</span><br><span class="line"></span><br><span class="line"><span class="comment">; The address on which to accept FastCGI requests.</span></span><br><span class="line"><span class="comment">; Valid syntaxes are:</span></span><br><span class="line"><span class="comment">;   &#x27;ip.add.re.ss:port&#x27;    - to listen on a TCP socket to a specific address on</span></span><br><span class="line"><span class="comment">;                            a specific port;</span></span><br><span class="line"><span class="comment">;   &#x27;port&#x27;                 - to listen on a TCP socket to all addresses on a</span></span><br><span class="line"><span class="comment">;                            specific port;</span></span><br><span class="line"><span class="comment">;   &#x27;/path/to/unix/socket&#x27; - to listen on a unix socket.</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> This value is mandatory.</span></span><br><span class="line"><span class="attr">listen</span> = <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; Choose how the process manager will control the number of child processes.</span></span><br><span class="line"><span class="comment">; Possible Values:</span></span><br><span class="line"><span class="comment">;   static  - a fixed number (pm.max_children) of child processes;</span></span><br><span class="line"><span class="comment">;   dynamic - the number of child processes are set dynamically based on the</span></span><br><span class="line"><span class="comment">;             following directives. With this process management, there will be</span></span><br><span class="line"><span class="comment">;             always at least 1 children.</span></span><br><span class="line"><span class="comment">;             pm.max_children      - the maximum number of children that can</span></span><br><span class="line"><span class="comment">;                                    be alive at the same time.</span></span><br><span class="line"><span class="comment">;             pm.start_servers     - the number of children created on startup.</span></span><br><span class="line"><span class="comment">;             pm.min_spare_servers - the minimum number of children in &#x27;idle&#x27;</span></span><br><span class="line"><span class="comment">;                                    state (waiting to process). If the number</span></span><br><span class="line"><span class="comment">;                                    of &#x27;idle&#x27; processes is less than this</span></span><br><span class="line"><span class="comment">;                                    number then some children will be created.</span></span><br><span class="line"><span class="comment">;             pm.max_spare_servers - the maximum number of children in &#x27;idle&#x27;</span></span><br><span class="line"><span class="comment">;                                    state (waiting to process). If the number</span></span><br><span class="line"><span class="comment">;                                    of &#x27;idle&#x27; processes is greater than this</span></span><br><span class="line"><span class="comment">;                                    number then some children will be killed.</span></span><br><span class="line"><span class="comment">;  ondemand - no children are created at startup. Children will be forked when</span></span><br><span class="line"><span class="comment">;             new requests will connect. The following parameter are used:</span></span><br><span class="line"><span class="comment">;             pm.max_children           - the maximum number of children that</span></span><br><span class="line"><span class="comment">;                                         can be alive at the same time.</span></span><br><span class="line"><span class="comment">;             pm.process_idle_timeout   - The number of seconds after which</span></span><br><span class="line"><span class="comment">;                                         an idle process will be killed.</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> This value is mandatory.</span></span><br><span class="line"><span class="attr">pm</span> = dynamic</span><br><span class="line"></span><br><span class="line"><span class="comment">; The number of child processes to be created when pm is set to &#x27;static&#x27; and the</span></span><br><span class="line"><span class="comment">; maximum number of child processes when pm is set to &#x27;dynamic&#x27; or &#x27;ondemand&#x27;.</span></span><br><span class="line"><span class="comment">; This value sets the limit on the number of simultaneous requests that will be</span></span><br><span class="line"><span class="comment">; served. Equivalent to the ApacheMaxClients directive with mpm_prefork.</span></span><br><span class="line"><span class="comment">; Equivalent to the PHP_FCGI_CHILDREN environment variable in the original PHP</span></span><br><span class="line"><span class="comment">; CGI. The below defaults are based on a server without much resources. Don&#x27;t</span></span><br><span class="line"><span class="comment">; forget to tweak pm.* to fit your needs.</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> Used when pm is set to &#x27;static&#x27;, &#x27;dynamic&#x27; or &#x27;ondemand&#x27;</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> This value is mandatory.</span></span><br><span class="line"><span class="attr">pm.max_children</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; The number of child processes created on startup.</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> Used only when pm is set to &#x27;dynamic&#x27;</span></span><br><span class="line"><span class="comment">; Default Value: min_spare_servers + (max_spare_servers - min_spare_servers) / 2</span></span><br><span class="line"><span class="attr">pm.start_servers</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; The desired minimum number of idle server processes.</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> Used only when pm is set to &#x27;dynamic&#x27;</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> Mandatory when pm is set to &#x27;dynamic&#x27;</span></span><br><span class="line"><span class="attr">pm.min_spare_servers</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; The desired maximum number of idle server processes.</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> Used only when pm is set to &#x27;dynamic&#x27;</span></span><br><span class="line"><span class="comment">; <span class="doctag">Note:</span> Mandatory when pm is set to &#x27;dynamic&#x27;</span></span><br><span class="line"><span class="attr">pm.max_spare_servers</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; Make specific Docker environment variables available to PHP</span></span><br><span class="line">env<span class="section">[DB_1_ENV_MYSQL_DATABASE]</span> = $DB_1_ENV_MYSQL_DATABASE</span><br><span class="line">env<span class="section">[DB_1_ENV_MYSQL_USER]</span> = $DB_1_ENV_MYSQL_USER</span><br><span class="line">env<span class="section">[DB_1_ENV_MYSQL_PASSWORD]</span> = $DB_1_ENV_MYSQL_PASSWORD</span><br><span class="line"></span><br><span class="line"><span class="attr">catch_workers_output</span> = <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<p>然而…</p>
<p>php-fpm 一启动就报错</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@8ddf4ad1d3b6:/usr/local/etc/php-fpm.d# php-fpm</span><br><span class="line"><span class="string">[05-Jul-2016 08:36:34]</span> ERROR: <span class="string">[/usr/local/etc/php-fpm.d/applll.pool.conf:4]</span> unknown entry &#x27;user&#x27;</span><br><span class="line"><span class="string">[05-Jul-2016 08:36:34]</span> ERROR: Unable to include /usr/local/etc/php-fpm.d/applll.pool.conf from /usr/local/etc/php-fpm.conf at line <span class="number">4</span></span><br><span class="line"><span class="string">[05-Jul-2016 08:36:34]</span> ERROR: failed to load configuration file &#x27;/usr/local/etc/php-fpm.conf&#x27;</span><br><span class="line"><span class="string">[05-Jul-2016 08:36:34]</span> ERROR: FPM initialization failed</span><br></pre></td></tr></table></figure>

<p>研究了好几个钟头无果</p>
<p>瞎弄的时候把 <code>app.pool.conf</code> 重命名成了 <code>aaa.pool.conf</code></p>
<p>神奇的发现， php-fpm 正常了</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@8ddf4ad1d3b6:/usr/local/etc/php-fpm.d# php-fpm</span><br><span class="line"><span class="string">[05-Jul-2016 08:34:07]</span> NOTICE: fpm is running, pid <span class="number">188</span></span><br><span class="line"><span class="string">[05-Jul-2016 08:34:07]</span> NOTICE: ready to handle connections</span><br></pre></td></tr></table></figure>

<p>然后测试了几个文件名，发现只要是 <code>app</code> 打头，都会造成 php-fpm 抽筋…目测是撞上了什么奇怪的规则</p>
<p>然而我 Google 搜了好久都没发现有人报告这个问题…_(:3」∠)_</p>
<p>嘛，自己记录一下吧.</p>

            
        </div>
    </div>
    <footer class="article-footer">
    </footer>
</article>

        
            <article class="article article-type-post article-index ">
    <header class="article-header">
        
            
                <h1 class="title">
                    <a href="/2016/01/17/laravel%E5%9C%A8%E6%9E%81%E9%AB%98%E7%9A%84%E7%9E%AC%E9%97%B4%E5%B9%B6%E5%8F%91%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98/">Laravel 在极高的瞬间并发时出现的问题</a>
                </h1>
            
        
    </header>
    <div class="article-inner">
        <div class="article-meta">
            <div class="article-date">
                <i class="icon calendar" title="发布时间"></i>
                <time datetime="2016-01-17T06:36:00.000Z">2016-01-17
                    <small>14:36</small>
                </time>
            </div>
            
                <div class="article-category">
                    <i class="icon book" title="文章分类"></i>
                    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
                </div>
            
            
        </div>
        <div class="article-entry">
            
                <p>又踩了了一个坑</p>
<p>之前曾经出现过 laravel 在极高的瞬间并发的时候，会出现session状态丢失的问题。原因是laravel中，session默认储存在文件系统，在瞬间并发时，可能由于文件系统io的原因，导致session文件读写失败，进而造成session丢失。</p>
<p>这个问题我当时是直接把session存放在cookie或者数据库中解决了。</p>
<p>然而今天又出现了新状况，也是瞬间高并发的锅。</p>
<img src="/2016/01/17/laravel%E5%9C%A8%E6%9E%81%E9%AB%98%E7%9A%84%E7%9E%AC%E9%97%B4%E5%B9%B6%E5%8F%91%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98/20160117221844.jpg" class="">

<p>如图，这是在ngjs下的一个并发上传的控件，会同时并发上传选择的文件，且在上传前会并发请求以查询文件是否已上传，以完成续传功能。</p>
<p>1秒内大概有15个并发连接</p>
<p>在这几个并发连接中，有部分会发生错误，扔我一脸500</p>
<img src="/2016/01/17/laravel%E5%9C%A8%E6%9E%81%E9%AB%98%E7%9A%84%E7%9E%AC%E9%97%B4%E5%B9%B6%E5%8F%91%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98/20160117222400.jpg" class="">

<p>具体报错是^</p>
<p>然而，我明显没设错mysql账号密码啦</p>
<p>而且我.env文件中数据库相关的设置是：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">DB_HOST</span>=localhost</span><br><span class="line"><span class="attr">DB_DATABASE</span>=amaoto-core</span><br><span class="line"><span class="attr">DB_USERNAME</span>=root</span><br><span class="line">DB_PASSWORD=</span><br></pre></td></tr></table></figure>

<p>然而报错是说我用了forge作为用户名连接mysql</p>
<p>等等，forge好熟悉啊</p>
<p>这货不就是laravel配置文件中的连mysql的默认用户名咩</p>
<p>检查config&#x2F;database.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;mysql&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;driver&#x27;</span>    =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span>      =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;database&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_DATABASE&#x27;</span>, <span class="string">&#x27;forge&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_USERNAME&#x27;</span>, <span class="string">&#x27;forge&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;charset&#x27;</span>   =&gt; <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;collation&#x27;</span> =&gt; <span class="string">&#x27;utf8_unicode_ci&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;prefix&#x27;</span>    =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strict&#x27;</span>    =&gt; <span class="literal">false</span>,</span><br><span class="line">    ]，</span><br></pre></td></tr></table></figure>

<p>果然</p>
<p>也就是说，<code>env(&#39;DB_USERNAME&#39;, &#39;forge&#39;)</code> 没能成功读取<code>.env</code>文件</p>
<p>参考之前session状态丢失的解决方法，那就不读取.env咯</p>
<p>然而不用<code>.env</code>的话，把数据库账密写在<code>config/database.php</code>也不科学</p>
<p>于是翻了翻文档</p>
<p>发现<code>artisan</code>指令：<code>config:cache</code> 可缓存配置文件</p>
<p>马上执行试试，重新测试一看，完美解决。</p>
<p>嘛，所以难得的更新了blog做个笔记ww</p>

            
        </div>
    </div>
    <footer class="article-footer">
    </footer>
</article>

        
            <article class="article article-type-post article-index ">
    <header class="article-header">
        
            
                <h1 class="title">
                    <a href="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/">修复 Windows 10 中损坏的 Appx 应用</a>
                </h1>
            
        
    </header>
    <div class="article-inner">
        <div class="article-meta">
            <div class="article-date">
                <i class="icon calendar" title="发布时间"></i>
                <time datetime="2015-08-28T08:14:43.000Z">2015-08-28
                    <small>16:14</small>
                </time>
            </div>
            
                <div class="article-category">
                    <i class="icon book" title="文章分类"></i>
                    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
                </div>
            
            
                <div class="article-tag">
                    <i class="icon tags" title="文章标签"></i>
                    <a class="article-tag-none-link" href="/tags/win10/" rel="tag">win10</a>
                </div>
            
        </div>
        <div class="article-entry">
            
                <p>前段时间手贱把 Surface Pro 3 的 系统升级到了 Windows Indsider Fast Ring 通道的 10525 版本，然后发现 <a target="_blank" rel="noopener" href="https://www.google.com/intl/zh-CN/chrome/browser/desktop/index.html">Chrome</a> 和 <a href="virtualbox.org">Virtual Box</a> 都出现了兼容性问题，估计是新的内存管理机制的锅。</p>
<p>因为工作需要用到 Vagrant，<a target="_blank" rel="noopener" href="http://virtualbox.org/">Virtual Box</a> 不能用简直不能忍，于是我滚回到了10240</p>
<p>然而没想到回滚完成后，好几个 Appx 应用都出问题了，应用名显示为 <code>@&#123;microsoft.windowscommunicationsapps_17.6120.42011.0_x64__8wekyb3d8bbwe&#125;</code> 类似这样的形式。</p>
<img src="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/000.jpg" class="">

<p>出问题的应用分别为 Edge、日历与邮件、应用商店、Cortana，其中 Edge 和 Cortana 只是名字没了Icon没了，商店则是变成了英文菜单，日历与邮件则是直接打开不能、更新不能、卸载不能、完全拿他没办法。</p>
<p>强行忍了一个多星期，实在受不了，于是昨天抽时间出来终于把这问题解决了，写下来记录下步骤 <del>顺便给blog填点东西</del></p>
<hr>
<p>首先，祭出最基本的 <code>wsreset</code> 大法，管理员运行，然而并没有什么卵用</p>
<p>试着跑了下系统自带的<code>疑难解答</code>，然而它提示说……</p>
<img src="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/001.jpg" class="">

<p>|дﾟ)</p>
<p>好咯，还是要自己动手</p>
<p>既然系统搞不定，那就自己来研究吧</p>
<p>管理员身份打开 <code>Powershell</code>，把所有包重新注册一遍</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AppXPackage</span> | <span class="keyword">Foreach</span> &#123;<span class="built_in">Add-AppxPackage</span> <span class="literal">-DisableDevelopmentMode</span> <span class="literal">-Register</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$_</span>.InstallLocation)\AppXManifest.xml&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>坐等了大概一分钟，跑完了</p>
<p>跑完瞬间发现，Edge恢复正常了，那写坏掉的应用名也恢复正常了！</p>
<p>然而还是有两个坏掉的图标……</p>
<img src="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/002.jpg" class="">

<p>日历与邮件还是不行_(:3」∠)_</p>
<p>瞄了一眼 Powershell，发现有报错</p>
<img src="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/003.jpg" class="">

<p>咦，<code>C:\</code> 在C盘根目录找是什么鬼</p>
<p>输出一下包信息看一下先：</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AppxPackage</span> microsoft.windowscommunicationsapps*</span><br></pre></td></tr></table></figure>

<img src="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/004.jpg" class="">

<p>妈了个鸡，为何 InstallLocation 不见了……</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\Program Files\WindowsApps\&quot;</span></span><br><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<img src="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/005.jpg" class="">

<p>妈了个蛋，还真没了这个文件夹……</p>
<p>存在的文件是 <code>42011</code> 然而包信息里面的是 <code>42001</code></p>
<p>好吧，估计这个就是问题所在了……</p>
<p>试试移除掉这个包咯</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AppxPackage</span> *microsoft.windowscommunicationsapps* | <span class="built_in">Remove-AppxPackage</span></span><br></pre></td></tr></table></figure>

<p>然而并没有用，还是读的根目录</p>
<p>想了想，既然只会读根目录，那我就把 42011 的 AppXManifest.xml 扔在 C: 根目录总能读到了吧？</p>
<p>于是把整个 42011 的所有文件复制一份扔在根目录</p>
<p>然后试着：</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Add-AppxPackage</span> <span class="literal">-register</span> <span class="string">&quot;C:\AppxManifest.xml&quot;</span> –DisableDevelopmentMode</span><br></pre></td></tr></table></figure>

<p>有反应！但是依然是报错信息，说在 <code>C:\ProgramData\Microsoft\Windows\AppRepository</code> 里面找不到对应的xml</p>
<p>那我就复制一份进去咯</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcopy <span class="string">&#x27;C:\AppxManifest.xml&#x27;</span> microsoft.windowscommunicationsapps_17.<span class="number">6106.42001</span>.<span class="number">0</span>_x64__8wekyb3d8bbwe.xml</span><br></pre></td></tr></table></figure>

<p>再试试看！</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Add-AppxPackage</span> <span class="literal">-register</span> <span class="string">&quot;C:\AppxManifest.xml&quot;</span> –DisableDevelopmentMode</span><br></pre></td></tr></table></figure>

<p>nice！成功运行！</p>
<p>打开开始菜单看看，邮件恢复了！</p>
<p>为了防止出现各种奇怪的问题，先把包砍了再从商店装一遍吧</p>
<p>然而并不能在GUI下直接卸载，那就老方法</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AppxPackage</span> *microsoft.windowscommunicationsapps* | <span class="built_in">Remove-AppxPackage</span></span><br></pre></td></tr></table></figure>

<p>ok，卸掉</p>
<p>然后商店重新安装</p>
<img src="/2015/08/28/%E4%BF%AE%E5%A4%8Dwindows10%E4%B8%AD%E6%8D%9F%E5%9D%8F%E7%9A%84appx%E5%BA%94%E7%94%A8/006.jpg" class="">

<p>搞定 (´・ω・&#96;)</p>

            
        </div>
    </div>
    <footer class="article-footer">
    </footer>
</article>

        
            <article class="article article-type-post article-index ">
    <header class="article-header">
        
            
                <h1 class="title">
                    <a href="/2015/02/17/homestead2.0.9%E7%9A%84%E4%B8%80%E4%B8%AA%E5%9D%91/">Homestead 2.0.9 的一个坑</a>
                </h1>
            
        
    </header>
    <div class="article-inner">
        <div class="article-meta">
            <div class="article-date">
                <i class="icon calendar" title="发布时间"></i>
                <time datetime="2015-02-17T01:55:00.000Z">2015-02-17
                    <small>09:55</small>
                </time>
            </div>
            
                <div class="article-category">
                    <i class="icon book" title="文章分类"></i>
                    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>
                </div>
            
            
        </div>
        <div class="article-entry">
            
                <p>整个下午都在调戏 <a target="_blank" rel="noopener" href="http://laravel.com/docs/5.0">Laravel 5</a> 和 <a target="_blank" rel="noopener" href="http://laravel.com/docs/5.0/homestead">Homestead</a>，然后掉坑里了……记录一下</p>
<p>Homestead.yaml 配置文件中，folders列，如果要设置为当前路径，不能够这样：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">folders:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">map:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">to:</span> <span class="string">/home/vagrant/your-dir</span></span><br></pre></td></tr></table></figure>

<p>而是要这样：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">folders:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">map:</span> <span class="string">./</span></span><br><span class="line">      <span class="attr">to:</span> <span class="string">/home/vagrant/your-dir</span></span><br></pre></td></tr></table></figure>

<p>就因为这尼玛的少了个斜杠 <code>/</code>， <code>/vagrant</code> 一直mount不了……</p>

            
        </div>
    </div>
    <footer class="article-footer">
    </footer>
</article>

        

        

    

</div>
<div class="right-side">
    <div class="right-side-assistance">
        
            
                
                
                <a target="_blank" rel="noopener" href="http://www.favo-soft.jp"><img src="http://www.favo-soft.jp/soft/product/sakura/banner/banner_l_kuro.jpg" alt="さくら、もゆ。-as the Night&#39;s, Reincarnation- 応援中！！"></a>
            
                
                
                <a target="_blank" rel="noopener" href="http://www.favo-soft.jp"><img src="http://www.favo-soft.jp/soft/product/sakura/banner/banner_l_haru.jpg" alt="さくら、もゆ。-as the Night&#39;s, Reincarnation- 応援中！！"></a>
            
                
                
                <a target="_blank" rel="noopener" href="http://www.eukleia.co.jp/eushully/"><img src="http://www.eukleia.co.jp/eushully/eu19/banner/banner_eu19lb.jpg" alt="「封緘のグラセスタ」応援中！"></a>
            
                
                
                <a target="_blank" rel="noopener" href="https://www.lumpofsugar.co.jp/product/yorikure/"><img src="https://www.lumpofsugar.co.jp/product/yorikure/campaign/images/bn/150_650a.jpg" alt="『縁りて此の葉は紅に』2018年1月26日発売予定！"></a>
            
                
                
                <a target="_blank" rel="noopener" href="https://www.lumpofsugar.co.jp/product/yorikure/"><img src="https://www.lumpofsugar.co.jp/product/yorikure/campaign/images/bn/150_650c.jpg" alt="『縁りて此の葉は紅に』2018年1月26日発売予定！"></a>
            
        
    </div>
</div>
    </div>

    <div class="site-footer">
    Copyright &copy; 2015-2023 Lialosiu All Rights Reserved. Powered by <a
            href="https://hexo.io/" target="_blank">Hexo</a>. Hosted on <a href="https://pages.github.com/"
                                                                           target="_blank">GitHub Pages</a>.
</div>

</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.min.js"
        integrity="sha256-1Q2q5hg2YXp9fYlM++sIEXOcUb8BRSDUsQ1zXvLBqmA=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-parallax.js@1.5.0/parallax.min.js"
        integrity="sha256-cNb9ArVGKhXkedowZK9xRxCpr6qqck5JvCAsuMzJlPw=" crossorigin="anonymous"></script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<script src="/js/app.js"></script>


</html>